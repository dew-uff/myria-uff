{"ftMode": "NONE", "plan": {"fragments": [{"operators": [{"argOperatorId": 1, "opType": "LocalMultiwayConsumer", "opName": "MyriaSplitConsumer", "opId": 0}, {"opName": "MyriaApply(L_RETURNFLAG=$0,L_LINESTATUS=$1,sum_qty=$2,sum_base_price=$3,sum_disc_price=$4,sum_charge=$5,avg_qty=(CAST(DOUBLE_TYPE, $2) / $6),avg_price=(CAST(DOUBLE_TYPE, $3) / $6),avg_qty=(CAST(DOUBLE_TYPE, $7) / $6),count_order=$6)", "opType": "Apply", "argChild": 0, "emitExpressions": [{"outputName": "L_RETURNFLAG", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 0}}, {"outputName": "L_LINESTATUS", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 1}}, {"outputName": "sum_qty", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 2}}, {"outputName": "sum_base_price", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 3}}, {"outputName": "sum_disc_price", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 4}}, {"outputName": "sum_charge", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 5}}, {"outputName": "avg_qty", "rootExpressionOperator": {"right": {"type": "VARIABLE", "columnIdx": 6}, "left": {"right": {"outputType": "DOUBLE_TYPE", "type": "TYPE"}, "left": {"type": "VARIABLE", "columnIdx": 2}, "type": "CAST"}, "type": "DIVIDE"}}, {"outputName": "avg_price", "rootExpressionOperator": {"right": {"type": "VARIABLE", "columnIdx": 6}, "left": {"right": {"outputType": "DOUBLE_TYPE", "type": "TYPE"}, "left": {"type": "VARIABLE", "columnIdx": 3}, "type": "CAST"}, "type": "DIVIDE"}}, {"outputName": "avg_qty", "rootExpressionOperator": {"right": {"type": "VARIABLE", "columnIdx": 6}, "left": {"right": {"outputType": "DOUBLE_TYPE", "type": "TYPE"}, "left": {"type": "VARIABLE", "columnIdx": 7}, "type": "CAST"}, "type": "DIVIDE"}}, {"outputName": "count_order", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 6}}], "opId": 2}, {"opType": "DbInsert", "opName": "MyriaStore(public:adhoc:q1)", "argOverwriteTable": true, "argChild": 2, "distributeFunction": {"indexes": [0, 1], "type": "Hash"}, "relationKey": {"userName": "public", "relationName": "q1", "programName": "adhoc"}, "opId": 3}]}, {"operators": [{"argOperatorId": 5, "opType": "ShuffleConsumer", "opName": "MyriaShuffleConsumer", "opId": 4}, {"argGroupFields": [0, 1], "opType": "Aggregate", "opName": "MyriaGroupBy($0,$1; SUM($2),SUM($3),SUM($4),SUM($5),SUM($6),SUM($7))", "opId": 6, "argChild": 4, "aggregators": [{"type": "Primitive", "aggOps": ["SUM"], "column": 2}, {"type": "Primitive", "aggOps": ["SUM"], "column": 3}, {"type": "Primitive", "aggOps": ["SUM"], "column": 4}, {"type": "Primitive", "aggOps": ["SUM"], "column": 5}, {"type": "Primitive", "aggOps": ["SUM"], "column": 6}, {"type": "Primitive", "aggOps": ["SUM"], "column": 7}]}, {"opName": "MyriaSplitProducer", "opType": "LocalMultiwayProducer", "argChild": 6, "opId": 1}]}, {"operators": [{"debroadcast": false, "opType": "TableScan", "opName": "MyriaScan(public:adhoc:LINEITEM)", "relationKey": {"userName": "public", "relationName": "LINEITEM", "programName": "adhoc"}, "opId": 7}, {"opName": "MyriaSelect(($10 <= \"1998-09-01\"))", "opType": "Filter", "argChild": 7, "argPredicate": {"rootExpressionOperator": {"right": {"valueType": "STRING_TYPE", "type": "CONSTANT", "value": "1998-09-01"}, "left": {"type": "VARIABLE", "columnIdx": 10}, "type": "LTEQ"}}, "opId": 8}, {"opName": "MyriaApply(L_QUANTITY=$4,L_EXTENDEDPRICE=$5,L_DISCOUNT=$6,L_RETURNFLAG=$8,L_LINESTATUS=$9,_COLUMN5_=($5 * (1 - $6)),_COLUMN6_=(($5 * (1 - $6)) * (1 + $7)))", "opType": "Apply", "argChild": 8, "emitExpressions": [{"outputName": "L_QUANTITY", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 4}}, {"outputName": "L_EXTENDEDPRICE", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 5}}, {"outputName": "L_DISCOUNT", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 6}}, {"outputName": "L_RETURNFLAG", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 8}}, {"outputName": "L_LINESTATUS", "rootExpressionOperator": {"type": "VARIABLE", "columnIdx": 9}}, {"outputName": "_COLUMN5_", "rootExpressionOperator": {"right": {"right": {"type": "VARIABLE", "columnIdx": 6}, "left": {"valueType": "LONG_TYPE", "type": "CONSTANT", "value": "1"}, "type": "MINUS"}, "left": {"type": "VARIABLE", "columnIdx": 5}, "type": "TIMES"}}, {"outputName": "_COLUMN6_", "rootExpressionOperator": {"right": {"right": {"type": "VARIABLE", "columnIdx": 7}, "left": {"valueType": "LONG_TYPE", "type": "CONSTANT", "value": "1"}, "type": "PLUS"}, "left": {"right": {"right": {"type": "VARIABLE", "columnIdx": 6}, "left": {"valueType": "LONG_TYPE", "type": "CONSTANT", "value": "1"}, "type": "MINUS"}, "left": {"type": "VARIABLE", "columnIdx": 5}, "type": "TIMES"}, "type": "TIMES"}}], "opId": 9}, {"argGroupFields": [3, 4], "opType": "Aggregate", "opName": "MyriaGroupBy($3,$4; SUM($0),SUM($1),SUM($5),SUM($6),COUNTALL,SUM($2))", "opId": 10, "argChild": 9, "aggregators": [{"type": "Primitive", "aggOps": ["SUM"], "column": 0}, {"type": "Primitive", "aggOps": ["SUM"], "column": 1}, {"type": "Primitive", "aggOps": ["SUM"], "column": 5}, {"type": "Primitive", "aggOps": ["SUM"], "column": 6}, {"type": "Primitive", "aggOps": ["COUNT"], "column": 0}, {"type": "Primitive", "aggOps": ["SUM"], "column": 2}]}, {"opName": "MyriaShuffleProducer(h($0,$1))", "opType": "ShuffleProducer", "argChild": 10, "distributeFunction": {"indexes": [0, 1], "type": "Hash"}, "opId": 5}]}], "type": "SubQuery"}, "rawQuery": "lineitem = scan('LINEITEM');\n\nq1 = select L_RETURNFLAG,\n       L_LINESTATUS,\n       sum(L_QUANTITY) as sum_qty,\n       sum(L_EXTENDEDPRICE) as sum_base_price,\n       sum(L_EXTENDEDPRICE*(1-L_DISCOUNT)) as sum_disc_price,\n       sum(L_EXTENDEDPRICE*(1-L_DISCOUNT)*(1+L_TAX)) as sum_charge,\n       FLOAT(sum(L_QUANTITY))/count(L_QUANTITY) as avg_qty, -- avg\n       FLOAT(sum(L_EXTENDEDPRICE))/count(L_EXTENDEDPRICE) as avg_price, -- avg\n       FLOAT(sum(L_DISCOUNT))/count(L_DISCOUNT) as avg_qty, -- avg\n       count(L_QUANTITY) as count_order  -- really COUNT(*)\nfrom\n       lineitem\nwhere\n  L_SHIPDATE <= \"1998-09-01\";       -- TODO fill in delta automatically; validation is 90 days delta\n--auto group by l_returnflag, l_linestatus \n\n-- TODO\n-- order by l_returnflag, l_linestatus\n\nstore(q1, q1);", "profilingMode": [], "language": "myrial", "logicalRa": "Store(public:adhoc:q1)[Apply(L_RETURNFLAG=$0,L_LINESTATUS=$1,sum_qty=$2,sum_base_price=$3,sum_disc_price=$4,sum_charge=$5,avg_qty=(CAST(DOUBLE_TYPE, $2) / $6),avg_price=(CAST(DOUBLE_TYPE, $3) / $7),avg_qty=(CAST(DOUBLE_TYPE, $8) / $9),count_order=$6)[GroupBy($3,$4; SUM($0),SUM($1),SUM($5),SUM($6),COUNT($0),COUNT($1),SUM($2),COUNT($2))[Apply(L_QUANTITY=$4,L_EXTENDEDPRICE=$5,L_DISCOUNT=$6,L_RETURNFLAG=$8,L_LINESTATUS=$9,_COLUMN5_=($5 * (1 - $6)),_COLUMN6_=(($5 * (1 - $6)) * (1 + $7)))[Select(($10 <= \"1998-09-01\"))[Scan(public:adhoc:LINEITEM)]]]]]"}
